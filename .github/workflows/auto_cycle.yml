name: META-Fâ´_Dâ‚„ Autonomous Cycle

on:
  push:
    branches:
      - main
  issues:
    types: [opened, edited, reopened]
  workflow_dispatch:

permissions:
  contents: write
  issues: write

jobs:
  run_autonomous_cycle:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ§© Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ§° Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: ğŸ“¦ Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      - name: ğŸ” Validate scripts and workflow
        run: |
          echo "Validant connexions..."
          test -f run.sh && echo "run.sh OK" || echo "Falta run.sh"
          test -f main.py && echo "main.py OK" || echo "Falta main.py"

      - name: ğŸš€ Execute symbolic core
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          echo "Executant META-F4_D4 cicle inicial..."
          chmod +x run.sh || true
          ./run.sh || python main.py

      - name: ğŸ“Š Verify correlation AENA vs BTC
        run: |
          echo "Verificant correlaciÃ³ (simulada)..."
          python - <<'PYCODE'
          import numpy as np
          print("CorrelaciÃ³ AENA vs BTC (mock test):", np.corrcoef([1,2,3], [1.05,2.1,2.9])[0,1])
          PYCODE

      - name: ğŸ§  Auto-report status
        uses: peter-evans/create-issue-from-file@v5
        with:
          title: "âœ… Cicle META-Fâ´_Dâ‚„ completat automÃ ticament"
          content-filepath: README.md
          labels: automated